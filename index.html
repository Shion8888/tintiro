<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Chinchiro â€“ Final Complete</title>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: #111;
  color: #fff;
  font-family: system-ui, sans-serif;
}
#ui {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 12px;
}
button {
  padding: 14px 28px;
  font-size: 18px;
  border-radius: 12px;
  border: none;
  font-weight: bold;
  cursor: pointer;
}
#btn { background: #ffcc00; }
#cheatBtn { background: #ff4444; color:#fff; }
#shonbenBtn { background: #00bcd4; color:#000; }
#result {
  position: fixed;
  top: 14px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 22px;
  text-align: center;
  white-space: pre;
}
</style>
</head>
<body>

<div id="result"></div>
<div id="ui">
  <button id="btn">ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚‹</button>
  <button id="cheatBtn">ðŸŽ² ã‚¤ã‚«ã‚µãƒžï¼ˆ456ã‚µã‚¤ï¼‰</button>
  <button id="shonbenBtn">ðŸ’¦ ã‚·ãƒ§ãƒ³ãƒ™ãƒ³</button>
</div>

<script type="module">
import * as THREE from "https://unpkg.com/three@0.160.0/build/three.module.js";
import * as CANNON from "https://unpkg.com/cannon-es@0.20.0/dist/cannon-es.js";

/* ===============================
   ðŸ”Š Dice Soundsï¼ˆç›¸å¯¾ãƒ‘ã‚¹æ˜Žç¤ºï¼‰
================================ */
const diceSounds = [
  new Audio("./ã‚¬ãƒ©ã‚¹ã§ãƒãƒ³ãƒãƒ­ãƒªãƒ³1.mp3"),
  new Audio("./ã‚¬ãƒ©ã‚¹ã§ãƒãƒ³ãƒãƒ­ãƒªãƒ³2.mp3")
];
diceSounds.forEach(s => s.preload = "auto");
let diceSoundIndex = 0;

function playDiceSound(){
  const s = diceSounds[diceSoundIndex];
  s.currentTime = 0;
  s.play().catch(e => console.warn("sound error", e));
  diceSoundIndex = (diceSoundIndex + 1) % diceSounds.length;
}

/* ===============================
   ï¼ˆä»¥ä¸‹ã€å…ƒã‚³ãƒ¼ãƒ‰ãã®ã¾ã¾ï¼‰
================================ */

/* é€”ä¸­çœç•¥ã›ãšã€ãã®ã¾ã¾ä½¿ç”¨ã—ã¦ãã ã•ã„ */
/* roll() ã®æœ€åˆã ã‘éŸ³ã‚’è¿½åŠ  */

function roll(){
  playDiceSound();   // â† ðŸ”Š ã“ã“ã ã‘è¿½åŠ 
  result.textContent="â€¦åˆ¤å®šä¸­";
  waitingForResult=true;

  const shonbenIndex = shonben
    ? Math.floor(Math.random()*diceBodies.length)
    : -1;

  diceBodies.forEach((b,i)=>{
    b.wakeUp();
    if(shonben){
      b.position.set((i-1)*0.9,4.2,0);
      if(i===shonbenIndex){
        b.velocity.set(
          (Math.random()<0.5?-1:1)*(5.4+Math.random()*0.8),
          3.8,
          (Math.random()-0.5)*2
        );
      } else {
        b.velocity.set(
          (Math.random()-0.5)*2.2,
          2.8,
          (Math.random()-0.5)*2.2
        );
      }
    } else {
      b.position.set((i-1)*0.9,3.5,0);
      b.velocity.set(
        (Math.random()-0.5)*3,
        3,
        (Math.random()-0.5)*3
      );
    }

    b.angularVelocity.set(
      (Math.random()*2-1)*6,
      (Math.random()*2-1)*6,
      (Math.random()*2-1)*6
    );
  });
}
</script>
</body>
</html>
